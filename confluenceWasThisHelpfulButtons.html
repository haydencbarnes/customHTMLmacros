<h3 style="font-weight: bold; margin-bottom: 10px;">Was this page helpful?</h3> 
<div style="min-height: 200px;">
  <span id="helpful-message"></span>
  <div id="helpful-buttons">
    <button class="aui-button" onclick="submitYes();">Yes</button>
    <div class="aui-dropdown">
      <button class="aui-button">No</button>
      <div class="aui-dropdown-menu">
        <ul>
          <li><a href="#" onclick="submitNo('It was not clear');">It was not clear</a></li>
          <li><a href="#" onclick="submitNo('It was not accurate');">It was not accurate</a></li>
          <li><a href="#" onclick="submitNo('It was not relevant');">It was not relevant</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>  
<style>
  .aui-dropdown {
    position: relative;
    display: inline-block;
  }

  .aui-dropdown-menu {
    display: none;
    position: absolute;
    min-width: 160px;
    z-index: 1;
    background-color: #f9f9f9;
    box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
  }

  .aui-dropdown-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .aui-dropdown-menu a {
    display: block;
    padding: 12px 16px;
    text-decoration: none;
    color: #333;
  }

  .aui-dropdown-menu a:hover {
    background-color: #f1f1f1;
  }

  .aui-dropdown:hover .aui-dropdown-menu {
    display: block;
  }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var feedbackPageId = "{{feedbackPageId}}";

    // Fetch page title
    var pageTitle = document.title;
    // URL encode page title
    var pageTitleEncoded = encodeURIComponent(pageTitle);

    function submitYes() {
      AJS.$.ajax({
        dataType: 'json',
        contentType: 'application/json',
        type: 'POST',
        url: '/rpc/json-rpc/confluenceservice-v2/getPage',
        data: '[' + feedbackPageId + ']',
        success: function (pageObject) {
          var responseObject = [];
          var responsePageObject = {};
          var responseOptionsObject = {};

          responsePageObject.space = pageObject.space;
          responsePageObject.title = pageObject.title;
          responsePageObject.content = pageObject.content + "<p>The page \"{{pageTitle}}\" was rated as helpful on {{currentDate}}</p>";
          responsePageObject.version = pageObject.version;
          responsePageObject.parentId = pageObject.parentId;
          responsePageObject.id = pageObject.id;
          responseObject.push(responsePageObject);

          responseOptionsObject.versionComment = "";
          responseOptionsObject.minorEdit = true;
          responseObject.push(responseOptionsObject);

          AJS.$.ajax({
            dataType: 'json',
            contentType: 'application/json',
            type: 'POST',
            url: '/rpc/json-rpc/confluenceservice-v2/updatePage',
            data: JSON.stringify(responseObject)
          });

          AJS.$('#helpful-buttons').hide();
          AJS.$('#helpful-message').html('Thanks for your feedback!');
        }
      });
    }        
	function submitNo(reason) {
// Change this to whichever email you want the issue to go to:  
var feedbackUserEmail = "example@ptxtrimble.com";
  
  // Fetch and encode the page path (URL)
  var pagePath = window.location.href;
  var pagePathEncoded = encodeURIComponent(pagePath);

  // Include the reason in the body content
  var bodyContent = "Reason: " + reason + " (Optional: Add why this page was not helpful for you.)";
  var bodyEncoded = encodeURIComponent(bodyContent);
  
  var reasonEncoded = encodeURIComponent(reason);

  var gmailComposeUrl = 'https://mail.google.com/mail/u/0/?view=cm&fs=1&to=' + feedbackUserEmail + '&su=Problem%20with%20page%20' + pageTitleEncoded + '&body=' + pagePathEncoded + '%0A%0A' + bodyEncoded;
  window.open(gmailComposeUrl, '_blank');
}

window.submitYes = submitYes;
window.submitNo = submitNo;
 });
</script> 
